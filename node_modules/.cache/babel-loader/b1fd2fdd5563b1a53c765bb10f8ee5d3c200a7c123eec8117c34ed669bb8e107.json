{"ast":null,"code":"import _classPrivateFieldLooseBase from \"/home/buck/Documents/software/formulate_graphql/node_modules/@babel/runtime/helpers/esm/classPrivateFieldLooseBase.js\";\nimport _classPrivateFieldLooseKey from \"/home/buck/Documents/software/formulate_graphql/node_modules/@babel/runtime/helpers/esm/classPrivateFieldLooseKey.js\";\nvar _jsxFileName = \"/home/buck/Documents/software/formulate_graphql/src/components/completion-input.d/completion-input.component.tsx\";\nimport React from 'react';\nimport \"./completion-input.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _findCompletions = /*#__PURE__*/_classPrivateFieldLooseKey(\"findCompletions\");\nvar _setCompletionState = /*#__PURE__*/_classPrivateFieldLooseKey(\"setCompletionState\");\nvar _keyboardHandler = /*#__PURE__*/_classPrivateFieldLooseKey(\"keyboardHandler\");\nvar _setCurrentSuggestion = /*#__PURE__*/_classPrivateFieldLooseKey(\"setCurrentSuggestion\");\nexport class CompletionInput extends React.Component {\n  constructor(props) {\n    super(props);\n    Object.defineProperty(this, _setCurrentSuggestion, {\n      value: _setCurrentSuggestion2\n    });\n    Object.defineProperty(this, _keyboardHandler, {\n      value: _keyboardHandler2\n    });\n    Object.defineProperty(this, _setCompletionState, {\n      value: _setCompletionState2\n    });\n    Object.defineProperty(this, _findCompletions, {\n      value: _findCompletions2\n    });\n    this.lastSearch = '';\n    this.value = \"\";\n    this.state = {\n      completions: null,\n      suggestion: -1\n    };\n  }\n  get inputHandler() {\n    var _this$props;\n    if ((_this$props = this.props) !== null && _this$props !== void 0 && _this$props.debounce && this.props.debounce > 0) return CompletionInput.debounceHandler(_classPrivateFieldLooseBase(this, _findCompletions)[_findCompletions], this.props.debounce, this);else return _classPrivateFieldLooseBase(this, _findCompletions)[_findCompletions].bind(this);\n  }\n  /* eslint-disable-next-line @typescript-eslint/ban-types -- we explicitly expect any function */\n  static debounceHandler(fn) {\n    let delay = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 50;\n    let self = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : window;\n    var timer; /* eslint-disable-line no-var -- explicitly refers to entire function */\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      // console.log('debounce',...args);\n      clearTimeout(timer);\n      timer = setTimeout(() => {\n        // console.log('trigger',...args);\n        try {\n          fn.apply(self, args);\n        } catch (e) {\n          console.error(e);\n        }\n      }, delay);\n    };\n  }\n  get keyboardHandler() {\n    return _classPrivateFieldLooseBase(this, _keyboardHandler)[_keyboardHandler].bind(this);\n  }\n  get currentSuggestion() {\n    if (this.state.completions && this.state.suggestion > -1) return this.state.completions[this.state.suggestion];\n    return undefined;\n  }\n  render() {\n    console.log(\"rendering...\");\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: this.props.id,\n      className: \"completionInput\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Search...\",\n        onInput: this.inputHandler,\n        onKeyDown: this.keyboardHandler\n        // value={}\n        ,\n        autoFocus: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 5\n      }, this), this.state.completions ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `completionList`,\n        children: this.state.completions.map((c, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `completion ${i == this.state.suggestion ? 'active' : ''}`,\n          children: c.html || c.value\n        }, c.key || c.value, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 9\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 6\n      }, this) : '']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 4\n    }, this);\n  }\n}\nfunction _findCompletions2(event) {\n  // console.log(\"updating this.state.completions\",this)\n  const lastSearch = this.lastSearch;\n  const search = this.lastSearch = event.target.value;\n  if (!search) {\n    _classPrivateFieldLooseBase(this, _setCompletionState)[_setCompletionState](null);\n  } else if (this.props.onInput) {\n    let lastCompletions = null;\n    if (lastSearch.startsWith(search)) {\n      lastCompletions = this.state.completions;\n    } else {\n      _classPrivateFieldLooseBase(this, _setCompletionState)[_setCompletionState](null); //user has pressed backspace => delete the old completions\n    }\n\n    _classPrivateFieldLooseBase(this, _setCompletionState)[_setCompletionState](this.props.onInput(search, lastCompletions));\n  }\n}\nfunction _setCompletionState2(completions) {\n  this.setState({\n    completions\n  });\n}\nfunction _keyboardHandler2(event) {\n  if (!event.target.hasOwnProperty('value')) {\n    console.warn(\"Event target didn't have 'value' prop:\", event);\n    return;\n  }\n  const input = event.target;\n  console.log(event, input);\n  switch (event.key) {\n    case 'ArrowUp':\n      {\n        const suggestion = this.state.suggestion - 1;\n        if (suggestion > -1) this.setState({\n          suggestion\n        });\n        console.log(\"up\", this.state);\n        break;\n      }\n    case 'ArrowDown':\n      {\n        var _this$state$completio;\n        const suggestion = this.state.suggestion + 1;\n        if (suggestion <= (((_this$state$completio = this.state.completions) === null || _this$state$completio === void 0 ? void 0 : _this$state$completio.length) || 0)) this.setState({\n          suggestion\n        });\n        console.log(\"down\", this.state);\n        break;\n      }\n    case 'Tab':\n      {\n        _classPrivateFieldLooseBase(this, _setCurrentSuggestion)[_setCurrentSuggestion](input);\n        setTimeout(() => {\n          console.log(\"focusing on \", input);\n          input.focus();\n        }, 100);\n        break;\n      }\n    case 'Enter':\n      {\n        console.log(\"enter\");\n        _classPrivateFieldLooseBase(this, _setCurrentSuggestion)[_setCurrentSuggestion](input);\n        if (this.props.onSubmit) this.props.onSubmit(input.value);else input.dispatchEvent(new Event(\"submit\"));\n        break;\n      }\n  }\n}\nfunction _setCurrentSuggestion2(input) {\n  const suggestion = this.currentSuggestion;\n  if (suggestion) {\n    input.value = suggestion.value;\n  }\n  return input.value;\n}\nexport default CompletionInput;","map":{"version":3,"names":["React","CompletionInput","Component","constructor","props","lastSearch","value","state","completions","suggestion","inputHandler","debounce","debounceHandler","bind","fn","delay","self","window","timer","args","clearTimeout","setTimeout","apply","e","console","error","keyboardHandler","currentSuggestion","undefined","render","log","id","map","c","i","html","key","event","search","target","onInput","lastCompletions","startsWith","setState","hasOwnProperty","warn","input","length","focus","onSubmit","dispatchEvent","Event"],"sources":["/home/buck/Documents/software/formulate_graphql/src/components/completion-input.d/completion-input.component.tsx"],"sourcesContent":["import React from 'react'\nimport \"./completion-input.css\"; \n\n\ntype CompletionItem={\n\tvalue:string\n\t,key?:string\n\t,html?:JSX.Element|JSX.Element[]\n}\ntype CompletionList=CompletionItem[]\n// type CompletionList=Array<{\n// \tvalue:string\n// \t,key?:string\n// \t,html?:JSX.Element|JSX.Element[]\n// }>\n\nexport type CompletionGenerator<T extends CompletionList>=(search:string,lastCompletions:T|null)=>T|null\n\ntype GenericHandler=(...args:any[])=>void\n\nexport interface Props<T extends CompletionList> {\n\tid?:string,\n\tdebounce?:number,\n\tonInput:CompletionGenerator<T> ,\n\tonSubmit?:GenericHandler\n}\n\ninterface State<T extends CompletionList>{\n\tcompletions:T|null\n\t,suggestion:number\n}\n\nexport class CompletionInput<T extends CompletionList> extends React.Component<Props<T>,State<T>> {\n\n\n\tpublic lastSearch='';\n\tpublic value=\"\";\n\t\n\n\tconstructor(props:Props<T>){\n\t\tsuper(props);\n\t\tthis.state={completions:null,suggestion:-1};\n\t}\n\t\n\tget inputHandler(){\n\t\tif(this.props?.debounce && this.props.debounce>0)\n\t\t\treturn CompletionInput.debounceHandler(this.#findCompletions,this.props.debounce,this);\n\t\telse\n\t\t\treturn this.#findCompletions.bind(this);\n\t}\n\n\t#findCompletions(event:React.ChangeEvent<HTMLInputElement>){\n\t\t// console.log(\"updating this.state.completions\",this)\n\t\tconst lastSearch=this.lastSearch;\n\t\tconst search=this.lastSearch=event.target.value;\n\t\tif(!search){\n\t\t\tthis.#setCompletionState(null);\n\t\t}else if(this.props.onInput){\n\t\t\tlet lastCompletions=null;\n\t\t\tif(lastSearch.startsWith(search)){\n\t\t\t\tlastCompletions=this.state.completions;\n\t\t\t}else{\n\t\t\t\tthis.#setCompletionState(null); //user has pressed backspace => delete the old completions\n\t\t\t}\n\t\t\tthis.#setCompletionState(this.props.onInput(search,lastCompletions));\n\t\t}\n\t}\n\n\t#setCompletionState(completions:State<T>[\"completions\"]){\n\t\tthis.setState({completions});\n\t}\n\n\t/* eslint-disable-next-line @typescript-eslint/ban-types -- we explicitly expect any function */\n\tstatic debounceHandler<F extends (...args:any[])=>any>(fn:F,delay=50,self:any=window) {\n\t\tvar timer:ReturnType<typeof setInterval>; /* eslint-disable-line no-var -- explicitly refers to entire function */\n\t\treturn (...args:Parameters<F>)=>{\n\t\t\t// console.log('debounce',...args);\n\t\t\tclearTimeout(timer);\n\t\t\ttimer=setTimeout(()=>{\n\t\t\t\t// console.log('trigger',...args);\n\t\t\t\ttry{fn.apply(self,args)}catch(e){console.error(e)}\n\t\t\t},delay);\n\t\t}\n\t}\n   \n\tget keyboardHandler(){\n\t\treturn this.#keyboardHandler.bind(this)\n\t}\n\t#keyboardHandler(event:React.KeyboardEvent<HTMLInputElement>){\n\t\tif(!event.target.hasOwnProperty('value')){\n\t\t\tconsole.warn(\"Event target didn't have 'value' prop:\",event)\n\t\t\treturn;\n\t\t}\n\t\tconst input=event.target as unknown as HTMLInputElement\n\t\tconsole.log(event,input);\n\t\tswitch(event.key){\n\t\t\tcase 'ArrowUp':{\n\t\t\t\tconst suggestion=this.state.suggestion-1;\n\t\t\t\tif(suggestion>-1)\n\t\t\t\t\tthis.setState({suggestion})\n\t\t\t\tconsole.log(\"up\",this.state)\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'ArrowDown':{\n\t\t\t\tconst suggestion=this.state.suggestion+1;\n\t\t\t\tif(suggestion<=(this.state.completions?.length||0))\n\t\t\t\t\tthis.setState({suggestion})\n\t\t\t\tconsole.log(\"down\",this.state)\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'Tab':{\n\t\t\t\tthis.#setCurrentSuggestion(input);\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\tconsole.log(\"focusing on \",input);\n\t\t\t\t\tinput.focus()\n\t\t\t\t},100);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'Enter':{\n\t\t\t\tconsole.log(\"enter\")\n\t\t\t\tthis.#setCurrentSuggestion(input);\n\t\t\t\tif(this.props.onSubmit)\n\t\t\t\t\tthis.props.onSubmit(input.value)\n\t\t\t\telse\n\t\t\t\t\tinput.dispatchEvent(new Event(\"submit\"))\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tget currentSuggestion(){\n\t\tif(this.state.completions && this.state.suggestion>-1)\n\t\t\treturn this.state.completions[this.state.suggestion]\n\t\treturn undefined\n\t}\n\t#setCurrentSuggestion(input:HTMLInputElement){\n\t\tconst suggestion=this.currentSuggestion\n\t\tif(suggestion){\n\t\t\tinput.value=suggestion.value\n\t\t}\n\t\treturn input.value;\n\t}\n\n\n\n\trender(){\t\n\t\tconsole.log(\"rendering...\")\t\n\n\t\treturn (\n\t\t\t<div id={this.props.id} className=\"completionInput\">\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\" \n\t\t\t\t\tplaceholder=\"Search...\" \n\t\t\t\t\tonInput={this.inputHandler} \n\t\t\t\t\tonKeyDown={this.keyboardHandler}\t\n\t\t\t\t\t// value={}\n\t\t\t\t\tautoFocus\n\t\t\t\t></input>\n\t\t\t\t{this.state.completions ? \n\t\t\t\t\t<div className={`completionList`}>{\n\t\t\t\t\t\tthis.state.completions.map(\n\t\t\t\t\t\t\t(c,i)=>(\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tkey={c.key||c.value} \n\t\t\t\t\t\t\t\t\tclassName={`completion ${i==this.state.suggestion?'active':''}`}\n\t\t\t\t\t\t\t\t>{c.html||c.value}</div>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t}</div>\n\t\t\t\t:''}\n\t\t\t</div>\n\t\t);\n\t}\n\n\n}\n\n\nexport default CompletionInput;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}